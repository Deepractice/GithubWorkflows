# é€šç”¨é”™è¯¯å¤„ç†å’ŒçŠ¶æ€åé¦ˆæ¨¡æ¿
# æ‰€æœ‰å‘½ä»¤éƒ½åº”è¯¥åŒ…å«è¿™äº›æ­¥éª¤

name: Command Error Handler Template

# 1. æ·»åŠ åˆå§‹ååº”ï¼ˆè¡¨ç¤ºæ”¶åˆ°å‘½ä»¤ï¼‰
- name: Add initial reaction
  if: always()
  uses: actions/github-script@v7
  with:
    script: |
      try {
        await github.rest.reactions.createForIssueComment({
          owner: context.repo.owner,
          repo: context.repo.repo,
          comment_id: context.payload.comment.id,
          content: 'eyes'  # ğŸ‘€ è¡¨ç¤ºæ­£åœ¨å¤„ç†
        });
      } catch (e) {
        console.log('Failed to add reaction:', e.message);
      }

# 2. ä¸»è¦æ‰§è¡Œæ­¥éª¤éœ€è¦è®¾ç½® id å’Œé”™è¯¯æ•è·
- name: Main execution
  id: main
  continue-on-error: true  # å…è®¸ç»§ç»­æ‰§è¡Œä»¥ä¾¿æŠ¥å‘Šé”™è¯¯
  run: |
    # ä½ çš„ä¸»è¦é€»è¾‘
    echo "Executing command..."

# 3. æˆåŠŸååº”
- name: Add success reaction
  if: steps.main.outcome == 'success'
  uses: actions/github-script@v7
  with:
    script: |
      await github.rest.reactions.createForIssueComment({
        owner: context.repo.owner,
        repo: context.repo.repo,
        comment_id: context.payload.comment.id,
        content: 'rocket'  # ğŸš€ è¡¨ç¤ºæˆåŠŸ
      });

# 4. å¤±è´¥å¤„ç†
- name: Handle failure
  if: steps.main.outcome == 'failure'
  uses: actions/github-script@v7
  with:
    script: |
      // æ·»åŠ å¤±è´¥ååº”
      await github.rest.reactions.createForIssueComment({
        owner: context.repo.owner,
        repo: context.repo.repo,
        comment_id: context.payload.comment.id,
        content: 'confused'  # ğŸ˜• è¡¨ç¤ºå¤±è´¥
      });
      
      // å‘å¸ƒé”™è¯¯æŠ¥å‘Š
      const errorMessage = `## âŒ Command Failed
      
      **Command**: \`${context.payload.comment.body}\`
      **Error**: The command execution failed. Please check the logs for details.
      
      ### ğŸ“‹ Error Details
      \`\`\`
      ${{ steps.main.outputs.error || 'Unknown error occurred' }}
      \`\`\`
      
      ### ğŸ’¡ Suggestions
      - Check the command syntax
      - Verify required permissions
      - Ensure all dependencies are configured
      
      ### ğŸ”— Workflow Run
      [View detailed logs](${context.serverUrl}/${context.repo.owner}/${context.repo.repo}/actions/runs/${context.runId})
      
      If this issue persists, please report it.`;
      
      await github.rest.issues.createComment({
        owner: context.repo.owner,
        repo: context.repo.repo,
        issue_number: context.issue.number,
        body: errorMessage
      });
      
      // æ ‡è®°å·¥ä½œæµå¤±è´¥
      core.setFailed('Command execution failed');