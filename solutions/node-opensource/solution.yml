# Node.js 开源项目解决方案
name: node-opensource
version: 1.0.0
description: Node.js 开源项目的 GitHub 工作流

# 组件配置
components:
  # 使用双主线分支策略
  branch_strategy: dual-flow
  
  # 启用的命令
  commands:
    - start      # /start development|pr|release - 开始开发、创建PR或发布
    - test       # /test - 运行测试
    - changeset  # /changeset - 声明变更（默认自动分析）
    - release    # /release - 创建版本
    - publish    # /publish - 发布到 NPM
  
  # 事件触发器（透明的自动化）
  # 所有事件通过发送命令评论来触发对应操作，保持完全透明
  events:
    - pr-opened-develop   # PR 到 develop 时 → 触发 /changeset --auto
    - pr-opened-main      # PR 到 main 时 → 触发 /release beta
    - pr-merged-develop   # PR 合并到 develop → 触发 /start release --preview
    - pr-merged-main      # PR 合并到 main → 可能触发 publish
  
  # Issue 标签
  labels:
    types:
      - "type: feature"
      - "type: bug"
      - "type: enhancement"
      - "type: docs"
      - "type: refactor"
    priorities:
      - "priority: critical"
      - "priority: high"
      - "priority: medium"
      - "priority: low"

# 工作流配置
workflows:
  ci:
    on:
      - push
      - pull_request
    branches:
      - main
      - develop
  
  cd:
    on:
      - release
    branches:
      - main

# 环境配置
environment:
  secrets:
    - name: NPM_TOKEN
      description: NPM 发布令牌
  
  variables:
    - name: NODE_VERSION
      value: "20"

# 项目配置
project:
  package_manager: npm
  test_framework: jest
  build_tool: tsc

# 输出配置
output:
  path: .github
  merge_workflows: true
  overwrite: false