# Develop åˆ†æ”¯ä¿æŠ¤è§„åˆ™
# ä¸­ç­‰ä¿æŠ¤ï¼Œç”¨äºé›†æˆæµ‹è¯•
name: develop
pattern: develop|dev  # æ”¯æŒå¤šä¸ªåç§°

protection_rules:
  # ==================
  # Pull Request è®¾ç½®
  # ==================
  require_pull_request_reviews:
    required_approving_review_count: 1      # éœ€è¦ 1 ä¸ªå®¡æ ¸
    dismiss_stale_reviews: true              # æ–°æäº¤æ—¶å–æ¶ˆæ—§å®¡æ ¸
    require_code_owner_reviews: false       # ä¸å¼ºåˆ¶éœ€è¦ä»£ç æ‰€æœ‰è€…
    require_last_push_approval: false       
    dismissal_restrictions:
      users: []
      teams: ["developers"]
      apps: []

  # ==================
  # çŠ¶æ€æ£€æŸ¥
  # ==================
  required_status_checks:
    strict: false                            # ä¸éœ€è¦åŸºäºæœ€æ–°ä»£ç 
    contexts:                                # å¿…é¡»é€šè¿‡çš„æ£€æŸ¥
      # åŸºç¡€æµ‹è¯•
      - "continuous-integration/test"
      - "continuous-integration/lint"
      - "continuous-integration/build"
      # ç‰ˆæœ¬ç®¡ç†
      - "changeset-bot"

  # ==================
  # åˆå¹¶è®¾ç½®
  # ==================
  require_linear_history: false             # ä¸è¦æ±‚çº¿æ€§å†å²
  allow_squash_merge: true                  # å…è®¸ squash åˆå¹¶
  allow_merge_commit: true                  # å…è®¸ merge commit
  allow_rebase_merge: true                  # å…è®¸ rebase åˆå¹¶
  allow_auto_merge: true                    # å…è®¸è‡ªåŠ¨åˆå¹¶
  delete_branch_on_merge: true              # åˆå¹¶ååˆ é™¤åˆ†æ”¯
  
  # ==================
  # æ¨é€é™åˆ¶
  # ==================
  restrict_pushes:
    enforce_admins: false                   # ç®¡ç†å‘˜ä¸éœ€è¦éµå®ˆè§„åˆ™
    push_restrictions:                      # è°å¯ä»¥æ¨é€
      users: []
      teams: ["developers", "maintainers"]
      apps: ["github-actions[bot]", "dependabot[bot]"]
  
  # ==================
  # å…¶ä»–ä¿æŠ¤
  # ==================
  allow_force_pushes: false                 # ç¦æ­¢å¼ºåˆ¶æ¨é€
  allow_deletions: false                    # ç¦æ­¢åˆ é™¤åˆ†æ”¯
  lock_branch: false                        # ä¸é”å®šåˆ†æ”¯
  require_conversation_resolution: false    # ä¸å¼ºåˆ¶è§£å†³å¯¹è¯
  require_deployments: false                # ä¸éœ€è¦éƒ¨ç½²
  
# ==================
# è‡ªåŠ¨åŒ–è§„åˆ™
# ==================
automation:
  # è‡ªåŠ¨åˆå¹¶
  auto_merge:
    enabled: true
    allowed_merge_methods: ["squash", "merge"]
    conditions:
      - all_checks_passed: true
      - approvals_count: ">= 1"
      - labels_include: ["automerge"]
      - labels_exclude: ["do-not-merge", "wip", "needs-review"]
  
  # è‡ªåŠ¨éƒ¨ç½²åˆ°æµ‹è¯•ç¯å¢ƒ
  auto_deploy:
    enabled: true
    environment: staging
    trigger: push
    url: "https://staging.example.com"
    
  # æ ‡ç­¾ç®¡ç†
  auto_label:
    # è‡ªåŠ¨æ·»åŠ  changeset çŠ¶æ€
    changeset_status:
      has_changeset: "changeset: added"
      no_changeset: "changeset: missing"
    
    # PR ç±»å‹æ ‡ç­¾
    pr_type:
      feature: ["feature/*", "feat/*"]
      bugfix: ["fix/*", "bugfix/*", "hotfix/*"]
      docs: ["docs/*"]
      chore: ["chore/*", "deps/*"]
      
  # åˆ†æ”¯åŒæ­¥
  sync:
    from: main
    auto_sync: true
    sync_on:
      - main_merge
      - hotfix_merge
    create_pr: true
    pr_title: "ğŸ”„ Sync develop with main"
    pr_labels: ["sync", "automerge"]
    
  # æµ‹è¯•æŠ¥å‘Š
  test_report:
    enabled: true
    comment_on_pr: true
    fail_on_decrease: true
    coverage_threshold: 70